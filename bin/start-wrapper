#!/usr/bin/env ruby

arg = ARGV[0]
ruby_versions = ["2.3", "2.2", "2.1", "2.0"]
actual_ruby_version = RUBY_VERSION.split('.').map{|s|s.to_i}
left_bound = '2.0.0'.split('.').map{|s|s.to_i}
right_bound = '2.3.1'.split('.').map{|s|s.to_i}

if (actual_ruby_version <=> left_bound) > -1 && (actual_ruby_version <=> right_bound) < 1
  exec("ruby #{File.join(File.expand_path(File.dirname(__FILE__)), "/codedeploy-agent")} #{arg}")
end

ruby_versions.each do |i|
  ruby_dir = "/usr/bin/ruby#{i}"
  if File.file?(ruby_dir)
    exec("#{ruby_dir} #{File.join(File.expand_path(File.dirname(__FILE__)), "/codedeploy-agent")} #{arg}")
  end
end

puts "No supported ruby version found. Code Deploy Host Agent suuports Ruby version of 2.0.x to 2.3.x."
exit(1)
